(function(d){var f,n,b,e,j,r,o;d.fn.SwaggPlayer=function(v){if(!soundManager||soundManager===undefined||soundManager==="undefined"){k()}var u=d.extend(v,{player:this.attr("id")});t.init(u)};var h=function(){this.props={}};h.prototype.setup=function(){this.props.useArt=(b.art.length>0);this.props.playList=(b.playlist.length>0)};var s=function(){};s.prototype.error=function(u){if(e.props.debug===true&&n.isIe===false){console.error("Swagg Player::Error::"+u)}};s.prototype.info=function(u){if(e.props.debug===true&&n.isIe===false){console.log("Swagg Player::Info::"+u)}};s.prototype.warn=function(u){if(e.props.debug===true&&n.isIe===false){console.log("Swagg Player::Warning::"+u)}};s.prototype.apierror=function(u){if(e.props.debug===true&&n.isIe===false){console.log("Swagg Player::API Error::"+u)}};var c=function(){this.last_song=0;this.songs={};this.curr_sprite_class="";this.isIe=a.isIe();this.curr_song=0;this.vol_interval=20;this.interval_id=-1};c.prototype.processSongs=function(u){var v=new Array(),z=u.length,w=e;var A=function(B,C){this.url=B.url;this.artist=B.artist;this.title=B.title;this.id=C};A.prototype.configureArt=function(B){this.image=new Image();this.image.src=B};for(var y=0;y<z;y++){var x=new A(u[y],y);if(w.props.useArt===true&&u[y].thumb!==undefined){x.configureArt(u[y].thumb);u[y].image=new Image();u[y].image.src=u[y].thumb}v.push(x)}this.songs=v;this.last_song=this.songs.length-1};c.prototype.getSongs=function(){var u=e.props.data;if(typeof u==="string"){d.ajax({type:"GET",url:u,dataType:"json",success:function(v){n.processSongs(v)},error:function(x,v,w){f.error("There was a problem fetching your songs from the server: "+w)}})}else{this.processSongs(u)}};var q=function(){this.div=null;this.player=null;this.playlist=null;this.art=null;this.loading_indication=null;this.progress_wrapper=null;this.bar=null;this.loaded=null;this.song_info=null;this.controls_div=null;this.bridge_data=null;this.user_art_css={height:{height:0,width:0}};this.metadata={progressWrapperWidth:0}};q.prototype.initHtml=function(){f.info("initHtml()");this.div=d("#"+this.player);this.playlist=d("#"+this.player+" .swagg-player-list");this.art=d("#"+this.player+" .swagg-player-album-art");this.loading_indication=d("#"+this.player+" img.swagg-player-loading");this.progress_wrapper=d("#"+this.player+" .swagg-player-progress-wrapper");this.bar=d("#"+this.player+" .swagg-player-bar");this.loaded=d("#"+this.player+" .swagg-player-loaded");this.song_info=d("#"+this.player+" .swagg-player-song-info");this.controls_div=d("#"+this.player+" .swagg-player-controls");this.user_art_css={height:0,width:0}};q.prototype.setupProgressBar=function(){f.info("SetupProgressBar()");if(this.progress_wrapper.length>0){var x=d("#"+this.player+" div.swagg-player-progress-wrapper"),u=x.css("height"),w=d("<div></div>"),v=d("<div></div>");v.addClass("swagg-player-loaded");v.css("height",u).css("width",0).css("float","left").css("margin-left","0");x.append(v);this.loaded=d("#"+this.player+" div.swagg-player-loaded");w.addClass("swagg-player-bar");w.css("height",u).css("width",0).css("float","left").css("margin-left","auto");v.append(w);this.bar=d("#"+this.player+" div.swagg-player-bar");this.metadata.progressWrapperWidth=parseFloat(this.progress_wrapper.css("width"))}};var m=function(){this.play=null;this.skip=null;this.back=null;this.stop=null};m.prototype.setup=function(v){var u=o;this.play=d("#"+b.player+" .swagg-player-play-button");this.skip=d("#"+b.player+" .swagg-player-skip-button");this.back=d("#"+b.player+" .swagg-player-back-button");this.stop=d("#"+b.player+" .swagg-player-stop-button");if(u.play!==null){this.play.css("cursor","pointer")}if(u.skip!==null){this.skip.css("cursor","pointer")}if(u.back!==null){this.back.css("cursor","pointer")}if(u.stop!==null){this.stop.css("cursor","pointer")}v.css("cursor","pointer")};var l=function(){};l.prototype.bindControllerEvents=function(v){f.info("Binding controller button events");var z=c,y=o.imagesLoaded,w=e,x=z.img,u=o,A=(w.props.buttonHover===undefined)?false:w.props.buttonHover;v.play.bind({click:function(){t.play("playlink click",n.curr_song);return false},mouseover:function(){if(y===true&&A){d(this).attr("src",u.playOver.src)}},mouseout:function(){if(y===true&&A){d(this).attr("src",u.play.src)}}});v.skip.bind({click:function(){t.skip(1);return false},mouseover:function(){if(y===true&&A){d(this).attr("src",u.skipOver.src)}},mouseout:function(){if(y===true&&A){d(this).attr("src",u.skip.src)}}});v.stop.bind({click:function(){t.stopMusic(n.curr_song);return false},mouseover:function(){if(y===true&&A){d(this).attr("src",u.stopOver.src)}},mouseout:function(){if(y===true&&A){d(this).attr("src",u.stop.src)}}});v.back.bind({click:function(){t.skip(0);return false},mouseover:function(){if(y===true&&A){d(this).attr("src",u.backOver.src)}},mouseout:function(){if(y===true&&A){d(this).attr("src",u.back.src)}}})};l.prototype.bindMediaKeyEvents=function(){f.info("Binding media key events");var u=n.curr_song;d(document).keydown(function(v){if(!v){v=window.event}switch(v.which){case 179:t.play("Media key event switch",u);return false;case 178:t.stopMusic(u);return false;case 176:t.skip(1);return false;case 177:t.skip(0);return false;case 175:t.volume(u,1);return false;case 174:t.volume(u,0);return false}})};l.prototype.setupSeek=function(){var u=b;u.loaded.css("cursor","pointer").bind({click:function(C){var v=u.player+"-song-"+n.curr_song,F=u.metadata.progressWrapperWidth,w=soundManager.getSoundById(v),E=C.pageX-u.loaded.offset().left,D=w.bytesLoaded/w.bytesTotal,z=t.getDuration(w),B=E/F,A=F*D,y=Math.round(B*z);if(A>=F){w.setPosition(y)}}});u.loaded.bind("mouseover hover mousemove",function(C){var D=u.player+"-song-"+n.curr_song,w=e,A=soundManager.getSoundById(D),v=C.pageX-u.loaded.offset().left,B=t.getDuration(A),z=v/u.metadata.progressWrapperWidth,y=Math.round(z*B);t.millsToTime(y,-1);if(w.props.onSeekPreview!==undefined&&d.isFunction(w.props.onSeekPreview)){i.event_ref=C;w.props.onSeekPreview.apply(this,[])}})};var g=function(){this.play=null;this.playOver=null;this.pause=null;this.pauseOver=null;this.stop=null;this.stopOver=null;this.back=null;this.backOver=null;this.skip=null;this.skipOver=null;this.art=null;this.imagesLoaded=false};g.prototype.setup=function(u){if(u.buttonsDir!==undefined){r.setup(b.controls_div);this.loadButtonImages(u.buttonsDir)}else{u.buttonHover=false}if(u.spriteImg!==undefined){this.art=new Image();this.art.src=u.spriteImg}};g.prototype.loadButtonImages=function(u){f.info("loading images........");var w=(e.props.buttonHover===undefined)?false:e.props.buttonHover,v=r;f.info("Loading images for controls");if(v.play.length>0){this.play=new Image();this.play.src=u+"play.png";this.pause=new Image();this.pause.src=u+"pause.png";if(w===true){this.playOver=new Image();this.playOver.src=u+"play-over.png";this.pauseOver=new Image();this.pauseOver.src=u+"pause-over.png"}}if(v.skip.length>0){this.skip=new Image();this.skip.src=u+"skip.png";if(w===true){this.skipOver=new Image();this.skipOver.src=u+"skip-over.png"}}if(v.back.length>0){this.back=new Image();this.back.src=u+"back.png";if(w===true){this.backOver=new Image();this.backOver.src=u+"back-over.png"}}if(v.stop.length>0){this.stop=new Image();this.stop.src=u+"stop.png";if(w===true){this.stopOver=new Image();this.stopOver.src=u+"stop-over.png"}}this.imagesLoaded=true};var t={init:function(u){e=new h();e.props=d.extend(e.props,u);f=new s();n=new c();b=new q();b.player=u.player;b.initHtml();e.setup();n.getSongs();b.setupProgressBar();t.setupApi();r=new m();o=new g();o.setup(u);if(!soundManager.supported()){f.warn("Support for SM2 was not found immediately! A reboot will probably occur. We shall see what happense after that.")}else{f.info("SM2 support was found! It SHOULD be smooth sailing from here but hey, you never know - this web development stuff is tricky!")}soundManager.useHTML5Audio=true;j=new l();j.bindControllerEvents(r);j.bindMediaKeyEvents();soundManager.createSongs=function(){f.info("createSongs()");var D=n;if(D.songs[0]!==undefined){clearInterval(D.interval_id);var w=D.songs,F=soundManager,x=e,B=true,H=b,A=c,C=t,I,G=(B==="undefined"||B===undefined||B===false)?true:false;f.info("Auto load set to : "+G);for(var z=0,y=w.length;z<y;z++){I=F.createSound({id:H.player+"-song-"+z.toString(),url:w[z].url,autoLoad:G,onfinish:function(){if(i.repeatMode===false){if(D.curr_song!==D.last_song){C.skip(1)}else{C.playPauseButtonState(1);C.stopMusic(D.curr_song);var J=I.setPosition(0)}}else{C.repeat()}},onplay:function(){C.millsToTime(this.duration,0);C.playPauseButtonState(0);if(x.props.onPlay!==undefined&&d.isFunction(x.props.onPlay)){x.props.onPlay.apply(this,[])}if(C.loaded(this)===true){C.fillLoaded()}},onpause:function(){C.playPauseButtonState(1);if(x.props.onPause!==undefined&&d.isFunction(x.props.onPause)){x.props.onPause.apply(this,[])}},onstop:function(){C.playPauseButtonState(1);if(x.props.onStop!==undefined&&d.isFunction(x.props.onStop)){x.props.onStop.apply(this,[])}},onresume:function(){C.playPauseButtonState(0);if(x.props.onResume!==undefined&&d.isFunction(x.props.onResume)){x.props.onResume.apply(this,[])}},whileplaying:function(){C.progress(this);C.millsToTime(this.position,1);if(d.isFunction(x.props.whilePlaying)){x.props.whilePlaying.apply(this,[])}},whileloading:function(){C.whileLoading(this)},onerror:function(){f.error("An error occured while attempting to play this song. Sorry about that.");if(x.props.onError!==undefined&&d.isFunction(x.props.onError)){x.props.onError.apply(this,[])}}});I.id=b.player+"-song-"+z.toString();I.repeat=i.repeat;if(x.props.playList!==undefined&&x.props.playList===true){C.createElement(I)}}if(x.props.useArt===true){var v=D.songs,E=D.curr_song;H.loading_indication.remove();C.setAlbumArtStyling(0)}j.setupSeek();C.showSongInfo();if(x.props.autoPlay!==undefined&&x.props.autoPlay===true){setTimeout(function(){C.play("",D.curr_song)},1000)}if(x.props.onSetupComplete!==undefined&&d.isFunction(x.props.onSetupComplete)){x.props.onSetupComplete.apply(this,[])}f.info("Swagg Player ready!")}};soundManager.onload=function(){n.interval_id=setInterval("soundManager.createSongs()",5)};soundManager.onerror=function(){f.error("An error has occured with loading Sound Manager! Rebooting.");soundManager.flashLoadTimeout=0;clearInterval(n.interval_id);soundManager.url="swf";setTimeout(soundManager.reboot,20);setTimeout(function(){if(!soundManager.supported()){f.error("Something went wrong with loading Sound Manager. No tunes for you!");if(u.props.onError!==undefined&&jQuery.isFunction(u.props.onError)){u.props.onError.apply(this,[])}}},1500)}},getDuration:function(u){var v;if(!u.loaded===true){v=u.durationEstimate}else{v=u.duration}return v},repeat:function(u){f.info("repeat()");var v=b.player+"-song-"+n.curr_song,w=soundManager.getSoundById(v);t.resetProgressBar();w.setPosition(0);w.play()},play:function(w,u){f.info("Playing track: "+v+". Oh and "+w+" called me!");var v=b.player+"-song-"+u,x=soundManager.getSoundById(v);if(x.paused===true){f.info("Unpausing song");x.resume()}else{if(x.playState===1){f.info("Pausing current track");x.pause()}else{i.update();f.info("Playing current track from beginning");x.play()}}t.showSongInfo()},setupApi:function(){window.swaggPlayerApi=new p()},createElement:function(v){f.info("createElement()");var w=n.songs[parseInt(v.id.split("-")[3])],x="item-"+w.id,u=d("<li></li>");u.attr("id",x);u.addClass("swagg-player-playlist-item");u.html(w.title+" - "+w.artist);u.css("cursor","pointer");u.data("song",w);u.bind({click:function(){t.stopMusic(n.curr_song);var y=parseInt(d(this).data("song").id),z=function(){t.showSongInfo();t.play("switchArt() - by way of createElement",y)};n.curr_song=y;if(e.props.useArt===true){t.switchArt(y,z)}else{t.showSongInfo();t.play("switchArt() - by way of createElement",y)}return false}});b.playlist.append(u)},playPauseButtonState:function(z){f.info("PlayButtonState() state: "+z);var y=c,w=y.img,v=o.imagesLoaded,u,B,A=r.play,x=(e.props.buttonHover===undefined)?false:e.props.buttonHover;if(z===1){if(v===false){A.html("play ")}else{u=o.play.src;if(x===true){B=o.playOver.src}}}else{if(z===0){if(v===false){A.html("pause ")}else{u=o.pause.src;if(x===true){B=o.pauseOver.src}}}else{f.error("Invalid button state! : "+z);return false}}if(v===true){A.attr("src",u);if(x===true){A.bind({mouseout:function(){A.attr("src",u)},mouseover:function(){A.attr("src",B)}})}}},skip:function(w){f.info("skip()");var v=n,u=v.curr_song;if(w===1){if(u<v.songs.length){if(u==v.songs.length-1){u=0}else{u=u+1}}}else{if(w===0){if(u===0){u=v.songs.length-1}else{u=u-1}}else{f.error("Invalid skip direction flag: "+w);return false}}t.stopMusic(u);v.curr_song=u;if(e.props.useArt===true){if(e.props.onBeforeSkip!=="undfined"&&jQuery.isFunction(e.props.onBeforeSkip)){e.props.onBeforeSkip.apply(this,[])}t.switchArt(u)}else{t.showSongInfo();t.play("skip",u)}},jumpTo:function(u){var v=c;t.stopMusic(u);v.curr_song=u;if(e.props.useArt===true){if(e.props.onBeforeSkip!=="undfined"&&jQuery.isFunction(e.props.onBeforeSkip)){e.props.onBeforeSkip.apply(this,[])}t.switchArt(u)}else{t.showSongInfo();t.play("skip",u)}},wipeArtCss:function(){var u=b.art;u.removeClass(n.curr_sprite_class);u.css("height","");u.css("width","");u.css("background-image","");u.css("background","")},resetProgressBar:function(){b.bar.css("width",0);b.loaded.css("width",0)},resetTrackTime:function(){f.info("Resetting track time");i.fillTime(0,0,0,0)},stopMusic:function(u){f.info("stopMusic()");soundManager.stopAll();t.resetProgressBar();t.resetTrackTime()},volume:function(v,u){var x=b.player+"-song-"+v,y=soundManager.getSoundById(x),w=y.volume;if(u===1){f.info("Vol up");soundManager.setVolume(x,w+n.vol_interval)}else{if(u===0){f.info("Vol down");soundManager.setVolume(x,w-n.vol_interval)}else{f.info("Invalid volume flag!")}}},setAlbumArtStyling:function(w){var y=b.art,B=n,z=B.songs[w],v=B.songs,x=e,A=q;t.wipeArtCss();if(z.spriteClass!==undefined){y.addClass(z.spriteClass);B.curr_sprite_class=z.spriteClass}else{y.css("background"," transparent url("+v[w].image.src+")");if(x.props.morphArt===true){if(z.thumbHeight!==undefined){b.user_art_css.height=z.thumbHeight.toString()+"px"}else{var C=(x.props.defaultAlbumArtHeight!==undefined)?x.props.defaultAlbumArtHeight:"100";b.user_art_css.height=C.toString()+"px"}if(z.thumbWidth!==undefined){b.user_art_css.width=z.thumbWidth.toString()+"px"}else{var u=(x.props.defaultAlbumArtWidth!==undefined)?x.props.defaultAlbumArtWidth:"100";b.user_art_css.width=u.toString()+"px"}y.css(b.user_art_css)}}},switchArt:function(v){f.info("Will show  for song at index: "+v);var w=b.player+"-song-"+v,B=b.art,x=e,z=c,u=t,y=n.songs,A=y[v];if(d.ui){B.hide("slide",200,function(){u.wipeArtCss();u.setAlbumArtStyling(v);d(this).show("slide",function(){u.showSongInfo();u.play("skip",v);if(x.props.onAfterSkip!==undefined&&d.isFunction(x.props.onAfterSkip)){x.props.onAfterSkip.apply(this,[])}})})}else{B.fadeOut("slow",function(){u.wipeArtCss();u.setAlbumArtStyling(v);d(this).fadeIn("slow",function(){u.showSongInfo();u.play("skip",v);if(x.props.onAfterSkip!==undefined&&d.isFunction(x.props.onAfterSkip)){x.props.onAfterSkip.apply(this,[])}})})}},id3Fill:function(u){var v=_data_.songs[parseInt(u.id.split("-")[1])];if(typeof u.id3.TIT2!==undefined){v.title=u.id3.TIT2}else{if(typeof u.id3.songname!==undefined){v.title=u.id3.songname}else{}}if(typeof u.id3.TPE2!==undefined){v.artist=u.id3.TPE2}else{if(typeof u.id3.artist!==undefined){v.artist=u.id3.artist}else{}}},fillLoaded:function(){b.loaded.css("width",b.metadata.progressWrapperWidth)},loaded:function(u){if(u.loaded===true&&u.readyState===3&&u.bytesLoaded===u.bytesTotal){return true}else{return false}},whileLoading:function(x){var z=x.position,w=x.bytesLoaded/x.bytesTotal,y=x.duration;var u=b.metadata.progressWrapperWidth,v=u*w;b.loaded.css("width",v)},progress:function(w){var y=w.position;duration=0,loaded_ratio=w.bytesLoaded/w.bytesTotal;if(w.loaded===false){duration=w.durationEstimate;t.millsToTime(duration,0)}else{duration=w.duration}var x=y/duration,u=b.metadata.progressWrapperWidth,v=u*x;b.bar.css("width",v)},millsToTime:function(w,u){var x=Math.floor(w/1000),v=0;if(x>60){v=Math.floor(x/60);x=Math.round(x%60)}if(u===0){i.fillTotalTime(v,x)}else{if(u===1){i.fillCurrentTime(v,x)}else{if(u===-1){i.fillPreview(v,x)}else{f.error("Invalid flag passed to millsToTime()")}}}},showSongInfo:function(){var u=n,v=u.songs[u.curr_song];b.song_info.html("<p>"+v.artist+"  <br/>"+v.title+" </p>")}};var i={totalMinutes:null,totalSeconds:null,currMinutes:null,currSeconds:null,seconds:null,minutes:null,event_ref:null,currTitle:null,currArtist:null,currAlbum:null,currTempo:null,repeatMode:false,update:function(){var v=n,u=v.curr_song;this.currTitle=v.songs[u].title;this.currArtist=v.songs[u].artist;this.currAlbum=v.songs[u].album;this.currTempo=v.songs[u].tempo;f.info("Current song: ["+this.currArtist+"] ["+this.currTitle+"] ["+this.currTempo+"]")},fillTime:function(y,x,v,u){var w=i;this.totalMinutes=y;this.totalSeconds=x;this.currMinutes=v;this.currSeconds=u},fillTotalTime:function(v,u){this.totalMinutes=v;i.totalSeconds=u},fillCurrentTime:function(u,v){i.currMinutes=u;i.currSeconds=v},fillPreview:function(v,u){i.minutes=v;i.seconds=u},setEventRef:function(u){i.event_ref=u}};var p=function(){var u=this;u.currSong={getCurrTimeAsString:function(){var x=i,v=(x.currMinutes>9)?x.currMinutes:"0"+x.currMinutes.toString(),w=(x.currSeconds>9)?x.currSeconds:"0"+x.currSeconds.toString();return v+":"+w},getTotalTimeAsString:function(){var v=i,w=(v.totalMinutes>9)?v.totalMinutes:"0"+v.totalMinutes.toString(),x=(v.totalSeconds>9)?v.totalSeconds:"0"+v.totalSeconds.toString();return w+":"+x},getEventRef:function(){return i.event_ref},previewAsString:function(){var w=i;if(!isNaN(w.minutes)&&!isNaN(w.seconds)){var x=(w.minutes>9)?w.minutes:"0"+w.minutes.toString();var v=(w.seconds>9)?w.seconds:"0"+w.seconds.toString();return x+":"+v}else{return"wait."}},title:function(){return(i.currTitle!==null)?i.currTitle:"Unknown Title"},artist:function(){return(i.currArtist!==null)?i.currArtist:"Unknown Artist"},album:function(){return(i.currAlbum!==null)?i.currAlbum:"Unknown Album"},tempo:function(){return(i.currTempo!==null)?i.currTempo:"Unknown Tempo"}};u.playback={setRepeat:function(v){i.repeatMode=(v===true||v===false)?v:false;return u},inRepeat:function(){var v=i.repeat;return(v===true||v===false)?v:false},volUp:function(){t.volume(_data_.curr_song,1);return u},volDown:function(){t.volume(_data_.curr_song,0);return u},playTrack:function(v){var w=v-1;if(w<=(_data_.last_song)&&w>=0){t.jumpTo(v-1)}else{f.apierror("Invalid track number '"+v+"'")}return u},stop:function(){t.stopMusic(null)}}};var a={isIe:function(){return(navigator.userAgent.indexOf("MSIE")>-1)?true:false},isSafari:function(){return(navigator.userAgent.indexOf("AppleWebKit")>-1&&navigator.userAgent.indexOf("Chrome")===-1)}};var k=function(){f.info("Initializing SoundManager2");window.soundManager=new SoundManager();soundManager.url="swf";soundManager.wmode="transparent";soundManager.useFastPolling=true;if(a.isSafari()){soundManager.useHighPerformance=false}else{soundManager.useHighPerformance=true}soundManager.flashLoadTimeout=1000;soundManager.beginDelayedInit()}})(jQuery);