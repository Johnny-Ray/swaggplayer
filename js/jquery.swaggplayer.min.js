!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){Function.prototype.func=function(t,e){return this[t]||(this.prototype[t]=e),this},Function.prototype.funcs=function(t){for(var e in t)this.func(e,t[e])};var e={isIe:function(){return navigator.userAgent.indexOf("MSIE")>-1?!0:!1},isSafari:function(){return navigator.userAgent.indexOf("AppleWebKit")>-1&&-1===navigator.userAgent.indexOf("Chrome")}},n={ieStuff:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null===this)throw new TypeError;var e=new Object(this),n=e.length>>>0;if(0===n)return-1;var i=0;if(arguments.length>0&&(i=Number(arguments[1]),isNaN(i)?i=0:0!==i&&1/0!==i&&i!==-1/0&&(i=(i>0||-1)*Math.floor(Math.abs(i)))),i>=n)return-1;for(var s=i>=0?i:Math.max(n-Math.abs(i),0);n>s;s++)if(s in e&&e[s]===t)return s;return-1})}};t.fn.SwaggPlayer=function(i){if(i.id={},i.id=this.attr("id"),i.id){e.isIe()||console.time&&console.time("SwaggPlayerStart"),n.ieStuff();var s=new c;s.init(i)}else t.error("Swagg Player element missing id attribute!")};var i=function(t){this.PLAYER=t,this.props={},this.callbacks={},this.consoleSupport=!1,console&&(this.consoleSupport=!0)},s=function(t,e){this.PLAYER=t,this.log=t._config.consoleSupport,this.logging=t._config.props.logging||[],this.levelall=this.logging.indexOf("all")>-1,this.levelinfo=this.levelall===!0?!0:this.logging.indexOf("info")>-1,this.levelerror=this.levelall===!0?!0:this.logging.indexOf("error")>-1,this.levelapierror=this.levelall===!0?!0:this.logging.indexOf("apierror")>-1,this.levelwarn=this.levelall===!0?!0:this.logging.indexOf("warn")>-1,this.leveldebug=this.levelall===!0?!0:this.logging.indexOf("debug")>-1,this.id=e};s.funcs({error:function(t){this.levelerror&&this.log&&console.error("Swagg Player::"+this.id+"::Error::"+t)},info:function(t){this.levelinfo&&this.log&&console.log("Swagg Player::"+this.id+"::Info::"+t)},warn:function(t){this.levelwarn&&this.log&&console.warn("Swagg Player::"+this.id+"::Warning::"+t)},debug:function(t){this.leveldebug&&this.log&&console.warn("Swagg Player::"+this.id+"::Debug::"+t)},apierror:function(t){this.levelapierror&&thims.log&&console.error("Swagg Player::"+this.id+"::API Error::"+t)}});var o=function(){};o.func("timeString",function(t){var e=parseInt(t,10),n=e>9?t:"0"+t;return"60"!==n?n:"00"});var r=function(t){this.player=t,t._logger.debug("SoundFactory Initiated")};r.funcs({createSound:function(t){var e=this;this.player._html;var n=this.player._config,i=this.player._data.songs,s=t.id;i[t.id]||this.player._data.songs.push(t);var o=this.player._html.player+"-song-"+s.toString(),r=soundManager;r.callback=function(t,e,n,i){var s=function(n){t.player.executeIfExists(i,e,[n])};t.player[n](e,s)};var a=r.createSound({id:o,url:t.url,autoLoad:n.props.eagerLoad||!1,usePolicyFile:!1,onplay:function(){r.callback(e,this,"_onplay","onPlay")},onpause:function(){r.callback(e,this,"_onpause","onPause")},onstop:function(){r.callback(e,this,"_onstop","onStop")},onfinish:function(){r.callback(e,this,"_onfinish","onFinish")},onresume:function(){r.callback(e,this,"_onresume","onResume")},whileplaying:function(){r.callback(e,this,"_whileplaying","whilePlaying")},whileloading:function(){r.callback(e,this,"_whileloading","whileLoading")},onerror:function(){r.callback(e,this,"_onerror","onError")}});return a.id=o,a.repeat=e.player.internal.repeat,e.player._data.last_song=t.id,a}});var a=function(t,e){for(var n in t)this[n]=t[n],"thumb"===n&&(this.image=new Image,this.image.onload=function(){},this.image.src=t[n]);this.id=e},l=function(t){t._logger.debug("Data intializing"),this.PLAYER=t,this.last_song=-1,this.songs=[],this.curr_sprite_class="",this.isIe=e.isIe(),this.curr_song=-1,this.vol_interval=20,this.interval_id=-1};l.funcs({processSongs:function(t){var e=this.PLAYER,n=[],i=t.length;e._html,e._config;for(var s=0;i>s;s++){var o=new a(t[s],s);n.push(o)}this.songs=n,this.last_song=this.songs.length-1},getSongs:function(){var t=this.PLAYER._config,e=t.props.data;this.processSongs(e)}});var g=function(t){this.PLAYER=t};g.funcs({initHtml:function(e){var n=document.querySelector("#"+e.id);this.PLAYER._logger.debug("Html initializing"),this.player=e.id,this.progress_wrapper=n.querySelectorAll(".swagg-player-progress-wrapper")[0],this.controls_div=t("#"+this.player+" .swagg-player-controls")},setupProgressBar:function(){if(this.PLAYER._logger.debug("setting up progress bar"),this.progress_wrapper){var t=this.progress_wrapper,e=t.offsetHeight,n=document.createElement("div"),i=document.createElement("div");i.className+="swagg-player-loaded",i.style.height=e+"px",i.style.width="0px",i.style.float="left",i.style["margin-left"]=0,this.loaded=i,this.loaded.offset=function(){return this.getBoundingClientRect()},t.appendChild(this.loaded),n.className+="swagg-player-bar",n.style.height=e+"px",n.style.width="0px",n.style.float="left",n.style["margin-left"]="auto",this.bar=n,this.bar.offset=function(){return this.getBoundingClientRect()},this.loaded.appendChild(this.bar)}}});var u=function(t){this.PLAYER=t};u.funcs({setup:function(){var t=this.PLAYER;t._imageLoader,t._logger.debug("setting up controls");var e=document.querySelector("#"+t._html.player);this.play=e.querySelectorAll(".swagg-player-play-button")[0],this.skip=e.querySelectorAll(".swagg-player-skip-button")[0],this.back=e.querySelectorAll(".swagg-player-back-button")[0],this.stop=e.querySelectorAll(".swagg-player-stop-button")[0]}});var h=function(t){this.PLAYER=t};h.funcs({bindControllerEvents:function(){function t(){var t=null;return"play"===r?t=function(){return e.play(e._data.curr_song),!1}:"skip"===r?t=function(){return e.skip(1),!1}:"stop"===r?t=function(){return e.stopMusic(),!1}:"back"===r&&(t=function(){return e.skip(0),!1}),t}var e=this.PLAYER,n=e._controls,i=e._imageLoader;i.imagesLoaded;var s,o=["play","back","stop","skip"];for(e._logger.debug("Binding controller button events"),s=0;s<o.length;s++){var r=o[s],a=t(o[s]);n[r]?n[r].addEventListener("click",a):e._logger.debug("Didn't find a "+r+" button")}},setupSeek:function(){function t(t){t.preventDefault();var e=s.player+"-song-"+i._data.curr_song,n=s.progress_wrapper.offsetWidth,o=soundManager.getSoundById(e),r=t.pageX-s.loaded.offset().left;o.bytesLoaded/o.bytesTotal;var a=i.getDuration(o),l=r/n,g=Math.round(l*a);g<o.bytesLoaded&&(o.setPosition(g),i.progress(o))}function e(t){t.preventDefault();var e=s.player+"-song-"+i._data.curr_song;i._config;var n=soundManager.getSoundById(e),o=t.pageX-s.loaded.offset().left,r=i.getDuration(n),a=o/s.progress_wrapper.offsetWidth,l=Math.round(a*r),g=i.millsToTime(l,1);i.executeIfExists("onSeekPreview",this,[t,g])}function n(t){i.executeIfExists("onSeekHide",this,[t])}var i=this.PLAYER,s=i._html;i._logger.debug("setting up seek events"),s.loaded.addEventListener("click",t),s.loaded.addEventListener("mouseover",e),s.loaded.addEventListener("mouseover",e),s.loaded.addEventListener("mousemove",e),s.loaded.addEventListener("mouseout",n)}});var p=function(t){this.PLAYER=t,this.imagesLoaded=!1};p.funcs({setup:function(){this.PLAYER._logger.debug("setting up image loader");var t=this.PLAYER._config.props;void 0!==t.buttonsDir&&(this.PLAYER._controls.setup(this.PLAYER._html.controls_div),this.loadButtonImages(t.buttonsDir))},loadButtonImages:function(t){var e=this.PLAYER,n=e._config.props.buttonHover||!1,i=e._controls;e._logger.debug("Loading images for controls"),i.play&&(this.play=new Image,this.play.src=t+"play.png",this.pause=new Image,this.pause.src=t+"pause.png",n===!0&&(this.playOver=new Image,this.playOver.src=t+"play-over.png",this.pauseOver=new Image,this.pauseOver.src=t+"pause-over.png")),i.skip&&(this.skip=new Image,this.skip.src=t+"skip.png",n===!0&&(this.skipOver=new Image,this.skipOver.src=t+"skip-over.png")),i.back&&(this.back=new Image,this.back.src=t+"back.png",n===!0&&(this.backOver=new Image,this.backOver.src=t+"back-over.png")),i.stop&&(this.stop=new Image,this.stop.src=t+"stop.png",n===!0&&(this.stopOver=new Image,this.stopOver.src=t+"stop-over.png")),this.imagesLoaded=!0,this.PLAYER._logger.info("Images Loaded.")}});var c=function(){};c.funcs({init:function(t){function n(){s._html;var t=s._data,n=t.songs[0],i=s._config;s.createSongs(),t.curr_song=0,void 0!==i.props.autoPlay&&i.props.autoPlay===!0&&setTimeout(function(){s.play(t.curr_song)},1e3),s.executeIfExists("onSetupComplete",this,[s._swaggPlayerApi,n]),e.isIe()||console.timeEnd&&console.timeEnd("SwaggPlayerStart"),s._logger.info("Swagg Player ready!")}function i(){s._logger.error("An error has occured with loading Sound Manager! Rebooting."),s.executeIfExists("onErrorComplete",s,[])}t=t;var s=this,o={url:"/swf",consoleOnly:!0,flashVersion:9,wmode:"transparent",useHTML5Audio:!0,useHighPerformance:!1,flashLoadTimeout:1e3,debugMode:!0};this.initComponents(t),soundManager.onerror=i,soundManager.onload=n,soundManager.ontimeout=i,soundManager.setup(o)},createSongs:function(){var t=this;this._logger.info("createSongs()");var e=t._data,n=e.songs;if(void 0!==e.songs[0]){t._config,t._html;for(var i=new r(t),s=null,o=null,a=0,l=n.length;l>a;a++)s=n[a],o=i.createSound(s)}else this._logger.error("No Songs!!")},initComponents:function(e){var n=this;this._config=new i(this);for(var o in e)this._config.props[o]=e[o];this._logger=new s(this,e.id),this._logger.info("initializing swagg player components"),this._data=new l(this),this._html=new g(this),this._html.initHtml(e),this._html.setupProgressBar(),this._controls=new u(n),this._imageLoader=new p(n),this._imageLoader.setup(),void 0!==e.buttonsDir&&this._controls.setup(this._html.controls_div),this._events=new h(this),this._events.setupSeek(),this._events.bindControllerEvents(),this.setupApi(),t.when(this._data.getSongs()).done(function(t){t?this.executeIfExists("onError",this,[]):soundManager.supported()?n._logger.info("SM2 support was found! It SHOULD be smooth sailing from here but hey, you never know - this web development stuff is tricky!"):n._logger.warn("Support for SM2 was not found immediately! A reboot will probably occur. We shall see what happense after that.")})},_whileplaying:function(t){this.progress(t);var e=t.loaded===!0?t.duration:t.durationEstimate,n=this.millsToTime(t.position),i=this.millsToTime(e),s={currentMins:n.mins,currentSecs:n.secs,totalMins:i.mins,totalSecs:i.secs};return[s]},_onplay:function(t,e){var n=this._data,i=n.songs[n.curr_song],s={};for(var o in i)"id"!=o&&"function"!=typeof i[o]&&(s[o]=i[o]);return this.playPauseButtonState(0),this.loaded(t)===!0&&this.fillLoaded(),e?e(s):[s]},_onpause:function(){return this.playPauseButtonState(1),[]},_onstop:function(){return this.playPauseButtonState(1),[]},_onfinish:function(t){var e;if(this.internal.repeatMode===!1){var n=parseInt(t.id.split("-")[3],10),i=this._data.songs.length-1;i>n?this.skip(1):(this.stopMusic(),e=[])}else this.repeat();return e},_onresume:function(){return this.playPauseButtonState(0),[]},_whileloading:function(t){var e=100*this.whileLoading(t).toFixed(2);return[Math.round(e)]},_onerror:function(){var t="An error occured while attempting to play this song. Sorry about that.";return this._logger.error(t),[t]},executeIfExists:function(t,e,n){var i=this._config;i.props[t]&&"function"==typeof i.props[t]&&i.props[t].apply(e,n)},getDuration:function(t){var e;return e=t.loaded!==!0?t.durationEstimate:t.duration},repeat:function(){var t=this._html.player+"-song-"+this._data.curr_song,e=soundManager.getSoundById(t);this._logger.info("repeat()"),this.resetProgressBar(),e.setPosition(0),e.play()},play:function(t){var e,n=this._html.player+"-song-"+t,i=soundManager.getSoundById(n);return this._logger.debug("Playing track: "+n),i.paused===!0?(this._logger.debug("Unpausing song"),i.resume()):1===i.playState?(this._logger.info("Pausing current track"),i.pause()):(e=!0,this._logger.info("Playing current track from beginning"),i.play()),e},setupApi:function(){this._logger.debug("setting up api"),this._swaggPlayerApi=new d(this),this.internal.player=this},playPauseButtonState:function(t){var e=this._imageLoader.imagesLoaded,n=this._imageLoader.play.src,i=this._controls.play;1===t?n=this._imageLoader.play.src:0===t?n=this._imageLoader.pause.src:this._logger.error("Invalid button state! : "+t),e===!0&&i.setAttribute("src",n)},skip:function(t){var e=this._data;this._html;var n=parseInt(e.curr_song);this._logger.info("skip()"),1===t?n<e.songs.length&&(n===e.songs.length-1?n=0:n+=1):0===t?0===n?n=parseInt(e.songs.length-1):n-=1:this._logger.error("Invalid skip direction flag: "+t),this.stopMusic(),e.curr_song=n,this.play(n)},jumpTo:function(t){this._logger.debug("jumping to track "+t),this.stopMusic(),this._data.curr_song=t,this.play(t)},resetProgressBar:function(){this._html.bar.style.width=0,this._html.loaded.style.width=0},stopMusic:function(){this._logger.debug("stopping music"),this.playPauseButtonState(1),this.resetProgressBar(),soundManager.stopAll()},volume:function(t,e){var n=this._html.player+"-song-"+t,i=soundManager.getSoundById(n),s=i.volume;1===e?(this._logger.debug("increasing volume"),soundManager.setVolume(n,s+this._data.vol_interval)):0===e?(this._logger.debug("decreasing volume"),soundManager.setVolume(n,s-this._data.vol_interval)):this._logger.error("Invalid volume flag!")},fillLoaded:function(){this._html.loaded.style.width=this._html.progress_wrapper.offsetWidth+"px"},loaded:function(t){return t.loaded===!0&&3===t.readyState&&t.bytesLoaded===t.bytesTotal?!0:!1},whileLoading:function(t){t.position;var e=t.bytesLoaded/t.bytesTotal;t.duration;var n=this._html.progress_wrapper.offsetWidth,i=n*e;return this._html.loaded.style.width=i+"px",e},progress:function(t){var e=t.position,n=0;t.bytesLoaded/t.bytesTotal,n=t.loaded===!1?t.durationEstimate:t.duration;var i=e/n,s=this._html.progress_wrapper.offsetWidth,o=s*i;this._html.bar.style.width=o+"px"},millsToTime:function(t){var e=new o,n=Math.floor(t/1e3),i=0;return n>60&&(i=Math.floor(n/60),n=Math.round(n%60)),60===n&&(i+=1,n=0),{mins:e.timeString(i),secs:e.timeString(n)}},internal:{player:null,repeatMode:!1}});var d=function(t){var e=this;this.player={adjustProgress:function(){var e=t._html,n=e.player+"-song-"+t._data.curr_song.toString(),i=soundManager.getSoundById(n);t.whileLoading(i)}},e.playback={setRepeat:function(n){return t.internal.repeatMode=n===!0||n===!1?n:!1,e},inRepeat:function(){var e=t.internal.repeat;return e===!0||e===!1?e:!1},volUp:function(){return t.volume(t._data.curr_song,1),e},volDown:function(){return t.volume(t._data.curr_song,0),e},playTrack:function(n){var i=n-1;return i<=t._data_.last_song&&i>=0?t.jumpTo(n-1):t._logger.apierror("Invalid track number '"+n+"'"),e},togglePlay:function(){t.play(t._data.curr_song)},stop:function(){t.stopMusic()},addTracks:function(e){t.PLAYER;var n,i,s,o,l=new r(t);if(Object.prototype.toString.call(trackDate).indexOf("Array")>-1)for(o=0;o<e.length;o++)n=t._data.last_song,i=new a(e[o],n+1),s=l.createSound(i);else n=t._data.last_song,i=new a(e,n+1),s=l.createSound(i);return callback?callback():void 0}}}});