!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){Function.prototype.func=function(t,e){return this[t]||(this.prototype[t]=e),this},Function.prototype.funcs=function(t){for(var e in t)this.func(e,t[e])};var e={isIe:function(){return navigator.userAgent.indexOf("MSIE")>-1?!0:!1},isSafari:function(){return navigator.userAgent.indexOf("AppleWebKit")>-1&&-1===navigator.userAgent.indexOf("Chrome")}},n={ieStuff:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null===this)throw new TypeError;var e=new Object(this),n=e.length>>>0;if(0===n)return-1;var s=0;if(arguments.length>0&&(s=Number(arguments[1]),isNaN(s)?s=0:0!==s&&1/0!==s&&s!==-1/0&&(s=(s>0||-1)*Math.floor(Math.abs(s)))),s>=n)return-1;for(var i=s>=0?s:Math.max(n-Math.abs(s),0);n>i;i++)if(i in e&&e[i]===t)return i;return-1})}};t.fn.SwaggPlayer=function(s){var i={};if(i.id=this.attr("id"),i.id){e.isIe()||console.time&&console.time("SwaggPlayerStart"),n.ieStuff();var o=t.extend(s,i),r=new c;r.init(o)}else t.error("Swagg Player element missing id attribute!")};var s=function(t){this.PLAYER=t,this.props={},this.callbacks={},this.consoleSupport=!1,console&&(this.consoleSupport=!0)},i=function(t,e){this.PLAYER=t,this.log=t._config.consoleSupport,this.logging=t._config.props.logging||[],this.levelall=this.logging.indexOf("all")>-1,this.levelinfo=this.levelall===!0?!0:this.logging.indexOf("info")>-1,this.levelerror=this.levelall===!0?!0:this.logging.indexOf("error")>-1,this.levelapierror=this.levelall===!0?!0:this.logging.indexOf("apierror")>-1,this.levelwarn=this.levelall===!0?!0:this.logging.indexOf("warn")>-1,this.leveldebug=this.levelall===!0?!0:this.logging.indexOf("debug")>-1,this.id=e};i.funcs({error:function(t){this.levelerror&&this.log&&console.error("Swagg Player::"+this.id+"::Error::"+t)},info:function(t){this.levelinfo&&this.log&&console.log("Swagg Player::"+this.id+"::Info::"+t)},warn:function(t){this.levelwarn&&this.log&&console.warn("Swagg Player::"+this.id+"::Warning::"+t)},debug:function(t){this.leveldebug&&this.log&&console.warn("Swagg Player::"+this.id+"::Debug::"+t)},apierror:function(t){this.levelapierror&&thims.log&&console.error("Swagg Player::"+this.id+"::API Error::"+t)}});var o=function(){};o.func("timeString",function(t){var e=parseInt(t,10),n=e>9?t:"0"+t;return"60"!==n?n:"00"});var r=function(t){this.player=t,t._logger.debug("SoundFactory Initiated")};r.funcs({createSound:function(e){var n=this;this.player._html;var s=this.player._config,i=this.player._data.songs,o=e.id;i[e.id]||this.player._data.songs.push(e);var r=this.player._html.player+"-song-"+o.toString(),a=soundManager;a.callback=function(e){t.when(e.scope.player[e.first](e.sound)).done(function(t){e.scope.player.executeIfExists(e.next,e.sound,t)})};var l=a.createSound({id:r,url:e.url,autoLoad:s.props.eagerLoad||!1,usePolicyFile:!1,onplay:function(){a.callback({scope:n,first:"_onplay",sound:this,next:"onPlay"})},onpause:function(){a.callback({scope:n,first:"_onpause",sound:this,next:"onPause"})},onstop:function(){a.callback({scope:n,first:"_onstop",sound:this,next:"onStop"})},onfinish:function(){a.callback({scope:n,first:"_onfinish",sound:this,next:"onFinish"})},onresume:function(){a.callback({scope:n,first:"_onresume",sound:this,next:"onResume"})},whileplaying:function(){a.callback({scope:n,first:"_whileplaying",sound:this,next:"whilePlaying"})},whileloading:function(){a.callback({scope:n,first:"_whileloading",sound:this,next:"whileLoading"})},onerror:function(){a.callback({scope:n,first:"_onerror",sound:this,next:"onError"})}});return l.id=r,l.repeat=n.player.internal.repeat,n.player._data.last_song=e.id,l}});var a=function(t,e){for(var n in t)this[n]=t[n],"thumb"===n&&(this.image=new Image,this.image.onload=function(){},this.image.src=t[n]);this.id=e},l=function(t){t._logger.debug("Data intializing"),this.PLAYER=t,this.last_song=-1,this.songs=[],this.curr_sprite_class="",this.isIe=e.isIe(),this.curr_song=-1,this.vol_interval=20,this.interval_id=-1};l.funcs({processSongs:function(t){var e=this.PLAYER,n=[],s=t.length;e._html,e._config;for(var i=0;s>i;i++){var o=new a(t[i],i);n.push(o)}this.songs=n,this.last_song=this.songs.length-1},getSongs:function(){var e=this,n=this.PLAYER._config,s=n.props.data;return"string"==typeof s?(t.ajax({type:"GET",url:s,dataType:"json",success:function(t){e.processSongs(t)},error:function(t,n,s){var i="There was a problem fetching your songs from the server: "+s;return e.PLAYER._logger.error(i),i}}),void 0):(this.processSongs(s),void 0)}});var u=function(t){this.PLAYER=t};u.funcs({initHtml:function(e){var n=document.querySelector("#"+e.id);this.PLAYER._logger.debug("Html initializing"),this.player=e.id,this.progress_wrapper=n.querySelectorAll(".swagg-player-progress-wrapper")[0],this.controls_div=t("#"+this.player+" .swagg-player-controls")},setupProgressBar:function(){if(this.PLAYER._logger.debug("setting up progress bar"),this.progress_wrapper){var t=this.progress_wrapper,e=t.offsetHeight,n=document.createElement("div"),s=document.createElement("div");s.className+="swagg-player-loaded",s.style.height=e+"px",s.style.width="0px",s.style.float="left",s.style["margin-left"]=0,this.loaded=s,this.loaded.offset=function(){return this.getBoundingClientRect()},t.appendChild(this.loaded),n.className+="swagg-player-bar",n.style.height=e+"px",n.style.width="0px",n.style.float="left",n.style["margin-left"]="auto",this.bar=n,this.bar.offset=function(){return this.getBoundingClientRect()},this.loaded.appendChild(this.bar)}}});var g=function(t){this.PLAYER=t,this.play=null,this.skip=null,this.back=null,this.stop=null};g.funcs({setup:function(){var e=this.PLAYER;e._imageLoader,e._logger.debug("setting up controls"),this.play=t("#"+e._html.player+" .swagg-player-play-button"),this.skip=t("#"+e._html.player+" .swagg-player-skip-button"),this.back=t("#"+e._html.player+" .swagg-player-back-button"),this.stop=t("#"+e._html.player+" .swagg-player-stop-button")}});var h=function(t){this.PLAYER=t};h.funcs({bindControllerEvents:function(){function t(){var t=null;return"play"===r?t=function(){return e.play(e._data.curr_song),!1}:"skip"===r?t=function(){return e.skip(1),!1}:"stop"===r?t=function(){return e.stopMusic(),!1}:"back"===r&&(t=function(){return e.skip(0),!1}),t}var e=this.PLAYER,n=e._controls,s=e._imageLoader;s.imagesLoaded;var i,o=["play","back","stop","skip"];for(e._logger.debug("Binding controller button events"),i=0;i<o.length;i++){var r=o[i],a=t(o[i]);n[r].bind({click:a})}},bindEvents:function(t,e){var n=t.func;controls[n].bind({click:e})},bindMediaKeyEvents:function(){var e=this.PLAYER,n=e._data.curr_song;e._logger.debug("Binding media key events"),t(document).keydown(function(t){switch(t||(t=window.event),t.which){case 179:return e.play(n),!1;case 178:return e.stopMusic(),!1;case 176:return e.skip(1),!1;case 177:return e.skip(0),!1;case 175:return e.volume(n,1),!1;case 174:return e.volume(n,0),!1;default:return!1}})},setupSeek:function(){function t(t){t.preventDefault();var e=i.player+"-song-"+s._data.curr_song,n=i.progress_wrapper.offsetWidth,o=soundManager.getSoundById(e),r=t.pageX-i.loaded.offset().left;o.bytesLoaded/o.bytesTotal;var a=s.getDuration(o),l=r/n,u=Math.round(l*a);u<o.bytesLoaded&&(o.setPosition(u),s.progress(o))}function e(t){t.preventDefault();var e=i.player+"-song-"+s._data.curr_song;s._config;var n=soundManager.getSoundById(e),o=t.pageX-i.loaded.offset().left,r=s.getDuration(n),a=o/i.progress_wrapper.offsetWidth,l=Math.round(a*r),u=s.millsToTime(l,1);s.executeIfExists("onSeekPreview",this,[t,u])}function n(t){s.executeIfExists("onSeekHide",this,[t])}var s=this.PLAYER,i=s._html;s._logger.debug("setting up seek events"),i.loaded.addEventListener("click",t),i.loaded.addEventListener("mouseover",e),i.loaded.addEventListener("mouseover",e),i.loaded.addEventListener("mousemove",e),i.loaded.addEventListener("mouseout",n)}});var p=function(t){this.PLAYER=t,this.play=null,this.playOver=null,this.pause=null,this.pauseOver=null,this.stop=null,this.stopOver=null,this.back=null,this.backOver=null,this.skip=null,this.skipOver=null,this.art=null,this.imagesLoaded=!1};p.funcs({setup:function(){this.PLAYER._logger.debug("setting up image loader");var t=this.PLAYER._config.props;void 0!==t.buttonsDir&&(this.PLAYER._controls.setup(this.PLAYER._html.controls_div),this.loadButtonImages(t.buttonsDir))},loadButtonImages:function(t){var e=this.PLAYER,n=e._config.props.buttonHover||!1,s=e._controls;e._logger.debug("Loading images for controls"),s.play.length>0&&(this.play=new Image,this.play.src=t+"play.png",this.pause=new Image,this.pause.src=t+"pause.png",n===!0&&(this.playOver=new Image,this.playOver.src=t+"play-over.png",this.pauseOver=new Image,this.pauseOver.src=t+"pause-over.png")),s.skip.length>0&&(this.skip=new Image,this.skip.src=t+"skip.png",n===!0&&(this.skipOver=new Image,this.skipOver.src=t+"skip-over.png")),s.back.length>0&&(this.back=new Image,this.back.src=t+"back.png",n===!0&&(this.backOver=new Image,this.backOver.src=t+"back-over.png")),s.stop.length>0&&(this.stop=new Image,this.stop.src=t+"stop.png",n===!0&&(this.stopOver=new Image,this.stopOver.src=t+"stop-over.png")),this.imagesLoaded=!0,this.PLAYER._logger.info("Images Loaded.")}});var c=function(){this._logger=null,this._data=null,this._html=null,this._config=null,this._events=null,this._controls=null,this._imageLoader=null,this._swaggPlayerApi=null};c.funcs({init:function(t){function n(){i._html;var t=i._data,n=t.songs[0],s=i._config;i.createSongs(),t.curr_song=0,void 0!==s.props.autoPlay&&s.props.autoPlay===!0&&setTimeout(function(){i.play(t.curr_song)},1e3),i.executeIfExists("onSetupComplete",this,[i._swaggPlayerApi,n]),e.isIe()||console.timeEnd&&console.timeEnd("SwaggPlayerStart"),i._logger.info("Swagg Player ready!")}function s(){i._logger.error("An error has occured with loading Sound Manager! Rebooting."),i.executeIfExists("onErrorComplete",i,[])}t=t;var i=this,o={url:"/swf",consoleOnly:!0,flashVersion:9,wmode:"transparent",useHTML5Audio:!0,useHighPerformance:!1,flashLoadTimeout:1e3,debugMode:!0};this.initComponents(t),soundManager.onerror=s,soundManager.onload=n,soundManager.ontimeout=s,soundManager.setup(o)},createSongs:function(){var t=this;this._logger.info("createSongs()");var e=t._data,n=e.songs;if(void 0!==e.songs[0]){t._config,t._html;for(var s=new r(t),i=null,o=null,a=0,l=n.length;l>a;a++)i=n[a],o=s.createSound(i)}else this._logger.error("No Songs!!")},initComponents:function(e){var n=this;this._config=new s(this),this._config.props=t.extend(this._config.props,e),this._logger=new i(this,e.id),this._logger.info("initializing swagg player components"),this._data=new l(this),this._html=new u(this),this._html.initHtml(e),this._html.setupProgressBar(),this._controls=new g(n),this._imageLoader=new p(n),this._imageLoader.setup(),void 0!==e.buttonsDir&&this._controls.setup(this._html.controls_div),this._events=new h(this),this._events.setupSeek(),this._events.bindControllerEvents(),this._events.bindMediaKeyEvents(),this.setupApi(),t.when(this._data.getSongs()).done(function(t){t?this.executeIfExists("onError",this,[]):soundManager.supported()?n._logger.info("SM2 support was found! It SHOULD be smooth sailing from here but hey, you never know - this web development stuff is tricky!"):n._logger.warn("Support for SM2 was not found immediately! A reboot will probably occur. We shall see what happense after that.")})},_whileplaying:function(t){this.progress(t);var e=t.loaded===!0?t.duration:t.durationEstimate,n=this.millsToTime(t.position),s=this.millsToTime(e),i={currentMins:n.mins,currentSecs:n.secs,totalMins:s.mins,totalSecs:s.secs};return[i]},_onplay:function(e){var n,s=this._data,i=s.songs[s.curr_song],o={};for(n in i)"id"!=n&&t.isFunction(i[n])===!1&&(o[n]=i[n]);return this.playPauseButtonState(0),this.loaded(e)===!0&&this.fillLoaded(),[o]},_onpause:function(){return this.playPauseButtonState(1),[]},_onstop:function(){return this.playPauseButtonState(1),[]},_onfinish:function(t){var e;if(this.internal.repeatMode===!1){var n=parseInt(t.id.split("-")[3],10),s=this._data.songs.length-1;s>n?this.skip(1):(this.stopMusic(),e=[])}else this.repeat();return e},_onresume:function(){return this.playPauseButtonState(0),[]},_whileloading:function(t){var e=100*this.whileLoading(t).toFixed(2);return[Math.round(e)]},_onerror:function(){var t="An error occured while attempting to play this song. Sorry about that.";return this._logger.error(t),[t]},executeIfExists:function(e,n,s){var i=this._config;i.props[e]&&t.isFunction(i.props[e])&&i.props[e].apply(n,s)},getDuration:function(t){var e;return e=t.loaded!==!0?t.durationEstimate:t.duration},repeat:function(){var t=this._html.player+"-song-"+this._data.curr_song,e=soundManager.getSoundById(t);this._logger.info("repeat()"),this.resetProgressBar(),e.setPosition(0),e.play()},play:function(t){var e,n=this._html.player+"-song-"+t,s=soundManager.getSoundById(n);return this._logger.debug("Playing track: "+n),s.paused===!0?(this._logger.debug("Unpausing song"),s.resume()):1===s.playState?(this._logger.info("Pausing current track"),s.pause()):(e=!0,this._logger.info("Playing current track from beginning"),s.play()),e},setupApi:function(){this._logger.debug("setting up api"),this._swaggPlayerApi=new d(this),this.internal.player=this},playPauseButtonState:function(t){var e=this._imageLoader.imagesLoaded,n=this._imageLoader.play.src,s=this._controls.play;1===t?n=this._imageLoader.play.src:0===t?n=this._imageLoader.pause.src:this._logger.error("Invalid button state! : "+t),e===!0&&s.attr("src",n)},skip:function(t){var e=this._data;this._html;var n=parseInt(e.curr_song);this._logger.info("skip()"),1===t?n<e.songs.length&&(n===e.songs.length-1?n=0:n+=1):0===t?0===n?n=parseInt(e.songs.length-1):n-=1:this._logger.error("Invalid skip direction flag: "+t),this.stopMusic(),e.curr_song=n,this.play(n)},jumpTo:function(t){this._logger.debug("jumping to track "+t),this.stopMusic(),this._data.curr_song=t,this.play(t)},resetProgressBar:function(){this._html.bar.style.width=0,this._html.loaded.style.width=0},stopMusic:function(){this._logger.debug("stopping music"),this.playPauseButtonState(1),this.resetProgressBar(),soundManager.stopAll()},volume:function(t,e){var n=this._html.player+"-song-"+t,s=soundManager.getSoundById(n),i=s.volume;1===e?(this._logger.debug("increasing volume"),soundManager.setVolume(n,i+this._data.vol_interval)):0===e?(this._logger.debug("decreasing volume"),soundManager.setVolume(n,i-this._data.vol_interval)):this._logger.error("Invalid volume flag!")},fillLoaded:function(){this._html.loaded.style.width=this._html.progress_wrapper.offsetWidth+"px"},loaded:function(t){return t.loaded===!0&&3===t.readyState&&t.bytesLoaded===t.bytesTotal?!0:!1},whileLoading:function(t){t.position;var e=t.bytesLoaded/t.bytesTotal;t.duration;var n=this._html.progress_wrapper.offsetWidth,s=n*e;return this._html.loaded.style.width=s+"px",e},progress:function(t){var e=t.position,n=0;t.bytesLoaded/t.bytesTotal,n=t.loaded===!1?t.durationEstimate:t.duration;var s=e/n,i=this._html.progress_wrapper.offsetWidth,o=i*s;this._html.bar.style.width=o+"px"},millsToTime:function(t){var e=new o,n=Math.floor(t/1e3),s=0;return n>60&&(s=Math.floor(n/60),n=Math.round(n%60)),60===n&&(s+=1,n=0),{mins:e.timeString(s),secs:e.timeString(n)}},internal:{player:null,repeatMode:!1}});var d=function(e){var n=this;this.player={adjustProgress:function(){var t=e._html,n=t.player+"-song-"+e._data.curr_song.toString(),s=soundManager.getSoundById(n);e.whileLoading(s)}},n.playback={setRepeat:function(t){return e.internal.repeatMode=t===!0||t===!1?t:!1,n},inRepeat:function(){var t=e.internal.repeat;return t===!0||t===!1?t:!1},volUp:function(){return e.volume(e._data.curr_song,1),n},volDown:function(){return e.volume(e._data.curr_song,0),n},playTrack:function(t){var s=t-1;return s<=e._data_.last_song&&s>=0?e.jumpTo(t-1):e._logger.apierror("Invalid track number '"+t+"'"),n},togglePlay:function(){e.play(e._data.curr_song)},stop:function(){e.stopMusic()},addTracks:function(n,s){var i,o,l,u,g=(e.PLAYER,new r(e));if(t.isArray(n))for(u=0;u<n.length;u++)i=e._data.last_song,o=new a(n[u],i+1),l=g.createSound(o);else i=e._data.last_song,o=new a(n,i+1),l=g.createSound(o);s&&s.apply(null,[])}}}});