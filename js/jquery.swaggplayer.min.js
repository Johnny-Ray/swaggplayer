!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";Function.prototype.func=function(t,e){return this[t]||(this.prototype[t]=e),this},Function.prototype.funcs=function(t){for(var e in t)this.func(e,t[e])};var e={isIe:function(){return navigator.userAgent.indexOf("MSIE")>-1?!0:!1},isSafari:function(){return navigator.userAgent.indexOf("AppleWebKit")>-1&&-1===navigator.userAgent.indexOf("Chrome")}},s={ieStuff:function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null===this)throw new TypeError;var e=new Object(this),s=e.length>>>0;if(0===s)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),isNaN(n)?n=0:0!==n&&1/0!==n&&n!==-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=s)return-1;for(var i=n>=0?n:Math.max(s-Math.abs(n),0);s>i;i++)if(i in e&&e[i]===t)return i;return-1})}};t.fn.SwaggPlayer=function(n){var i={};if(i.id=this.attr("id"),i.id){e.isIe()||console.time&&console.time("SwaggPlayerStart"),s.ieStuff();var r=t.extend(n,i),o=new c;o.init(r)}else t.error("Swagg Player element missing id attribute!")};var n=function(t){this.PLAYER=t,this.props={},this.callbacks={},this.consoleSupport=!1,console&&(this.consoleSupport=!0)},i=function(t,e){this.PLAYER=t,this.log=t._config.consoleSupport,this.logging=t._config.props.logging||[],this.levelall=this.logging.indexOf("all")>-1,this.levelinfo=this.levelall===!0?!0:this.logging.indexOf("info")>-1,this.levelerror=this.levelall===!0?!0:this.logging.indexOf("error")>-1,this.levelapierror=this.levelall===!0?!0:this.logging.indexOf("apierror")>-1,this.levelwarn=this.levelall===!0?!0:this.logging.indexOf("warn")>-1,this.leveldebug=this.levelall===!0?!0:this.logging.indexOf("debug")>-1,this.id=e};i.funcs({error:function(t){this.levelerror&&this.log&&console.error("Swagg Player::"+this.id+"::Error::"+t)},info:function(t){this.levelinfo&&this.log&&console.log("Swagg Player::"+this.id+"::Info::"+t)},warn:function(t){this.levelwarn&&this.log&&console.warn("Swagg Player::"+this.id+"::Warning::"+t)},debug:function(t){this.leveldebug&&this.log&&console.warn("Swagg Player::"+this.id+"::Debug::"+t)},apierror:function(t){this.levelapierror&&thims.log&&console.error("Swagg Player::"+this.id+"::API Error::"+t)}});var r=function(){};r.func("timeString",function(t){var e=parseInt(t,10),s=e>9?t:"0"+t;return"60"!==s?s:"00"});var o=function(t){this.player=t,t._logger.debug("SoundFactory Initiated")};o.funcs({createSound:function(e){var s=this;this.player._html;var n=this.player._config,i=this.player._data.songs,r=e.id;i[e.id]||this.player._data.songs.push(e);var o=this.player._html.player+"-song-"+r.toString(),a=soundManager;a.callback=function(e){t.when(e.scope.player[e.first](e.sound)).done(function(t){e.scope.player.executeIfExists(e.next,e.sound,t)})};var l=a.createSound({id:o,url:e.url,autoLoad:n.props.eagerLoad||!1,usePolicyFile:!1,onplay:function(){a.callback({scope:s,first:"_onplay",sound:this,next:"onPlay"})},onpause:function(){a.callback({scope:s,first:"_onpause",sound:this,next:"onPause"})},onstop:function(){a.callback({scope:s,first:"_onstop",sound:this,next:"onStop"})},onfinish:function(){a.callback({scope:s,first:"_onfinish",sound:this,next:"onFinish"})},onresume:function(){a.callback({scope:s,first:"_onresume",sound:this,next:"onResume"})},whileplaying:function(){a.callback({scope:s,first:"_whileplaying",sound:this,next:"whilePlaying"})},whileloading:function(){a.callback({scope:s,first:"_whileloading",sound:this,next:"whileLoading"})},onerror:function(){a.callback({scope:s,first:"_onerror",sound:this,next:"onError"})}});return l.id=o,l.repeat=s.player.internal.repeat,s.player._data.last_song=e.id,l}});var a=function(t,e){for(var s in t)this[s]=t[s],"thumb"===s&&(this.image=new Image,this.image.onload=function(){},this.image.src=t[s]);this.id=e},l=function(t){t._logger.debug("Data intializing"),this.PLAYER=t,this.last_song=-1,this.songs=[],this.curr_sprite_class="",this.isIe=e.isIe(),this.curr_song=-1,this.vol_interval=20,this.interval_id=-1};l.funcs({processSongs:function(t){var e=this.PLAYER,s=[],n=t.length;e._html,e._config;for(var i=0;n>i;i++){var r=new a(t[i],i);s.push(r)}this.songs=s,this.last_song=this.songs.length-1},getSongs:function(){var e=this,s=this.PLAYER._config,n=s.props.data;return"string"==typeof n?(t.ajax({type:"GET",url:n,dataType:"json",success:function(t){e.processSongs(t)},error:function(t,s,n){var i="There was a problem fetching your songs from the server: "+n;return e.PLAYER._logger.error(i),i}}),void 0):(this.processSongs(n),void 0)}});var u=function(t){this.PLAYER=t,this.div=null,this.player=null,this.playlist=null,this.art=null,this.loading_indication=null,this.progress_wrapper=null,this.bar=null,this.loaded=null,this.song_info=null,this.controls_div=null,this.bridge_data=null,this.artist=null,this.title=null,this.useArt=!1,this.playList=!1,this.metadata={progressWrapperWidth:0}};u.funcs({initHtml:function(e){this.PLAYER._logger.debug("Html initializing"),this.player=e.id,this.progress_wrapper=t("#"+this.player+" .swagg-player-progress-wrapper"),this.bar=t("#"+this.player+" .swagg-player-bar"),this.loaded=t("#"+this.player+" .swagg-player-loaded"),this.controls_div=t("#"+this.player+" .swagg-player-controls")},setupProgressBar:function(){if(this.PLAYER._logger.debug("setting up progress bar"),this.progress_wrapper.length>0){var e=t("#"+this.player+" div.swagg-player-progress-wrapper"),s=e.css("height"),n=t("<div></div>"),i=t("<div></div>");i.addClass("swagg-player-loaded").css("height",s).css("width",0).css("float","left").css("margin-left","0"),e.append(i),this.loaded=t("#"+this.player+" div.swagg-player-loaded"),n.addClass("swagg-player-bar").css("height",s).css("width",0).css("float","left").css("margin-left","auto"),i.append(n),this.bar=t("#"+this.player+" div.swagg-player-bar"),this.metadata.progressWrapperWidth=parseFloat(this.progress_wrapper.css("width"))}}});var g=function(t){this.PLAYER=t,this.play=null,this.skip=null,this.back=null,this.stop=null};g.funcs({setup:function(){var e=this.PLAYER;e._imageLoader,e._logger.debug("setting up controls"),this.play=t("#"+e._html.player+" .swagg-player-play-button"),this.skip=t("#"+e._html.player+" .swagg-player-skip-button"),this.back=t("#"+e._html.player+" .swagg-player-back-button"),this.stop=t("#"+e._html.player+" .swagg-player-stop-button")}});var h=function(t){this.PLAYER=t};h.funcs({bindControllerEvents:function(){function t(){var t=null;return"play"===o?t=function(){return e.play(e._data.curr_song),!1}:"skip"===o?t=function(){return e.skip(1),!1}:"stop"===o?t=function(){return e.stopMusic(),!1}:"back"===o&&(t=function(){return e.skip(0),!1}),t}var e=this.PLAYER,s=e._controls,n=e._imageLoader;n.imagesLoaded;var i,r=["play","back","stop","skip"];for(e._logger.debug("Binding controller button events"),i=0;i<r.length;i++){var o=r[i],a=t(r[i]);s[o].bind({click:a})}},bindEvents:function(t,e){var s=t.func;controls[s].bind({click:e})},bindMediaKeyEvents:function(){var e=this.PLAYER,s=e._data.curr_song;e._logger.debug("Binding media key events"),t(document).keydown(function(t){switch(t||(t=window.event),t.which){case 179:return e.play(s),!1;case 178:return e.stopMusic(),!1;case 176:return e.skip(1),!1;case 177:return e.skip(0),!1;case 175:return e.volume(s,1),!1;case 174:return e.volume(s,0),!1;default:return!1}})},setupSeek:function(){var t=this.PLAYER,e=t._html;t._logger.debug("setting up seek events"),e.loaded.css("cursor","pointer").bind({click:function(s){var n=e.player+"-song-"+t._data.curr_song,i=e.metadata.progressWrapperWidth,r=soundManager.getSoundById(n),o=s.pageX-e.loaded.offset().left,a=(r.bytesLoaded/r.bytesTotal,t.getDuration(r)),l=o/i,u=Math.round(l*a);u<r.bytesLoaded&&(r.setPosition(u),t.progress(r))}}),e.loaded.bind("mouseover hover mousemove",function(s){var n=e.player+"-song-"+t._data.curr_song,i=(t._config,soundManager.getSoundById(n)),r=s.pageX-e.loaded.offset().left,o=t.getDuration(i),a=r/e.metadata.progressWrapperWidth,l=Math.round(a*o),u=t.millsToTime(l,1);t.executeIfExists("onSeekPreview",this,[s,u])}),e.loaded.bind("mouseout",function(e){t.executeIfExists("onSeekHide",this,[e])})}});var p=function(t){this.PLAYER=t,this.play=null,this.playOver=null,this.pause=null,this.pauseOver=null,this.stop=null,this.stopOver=null,this.back=null,this.backOver=null,this.skip=null,this.skipOver=null,this.art=null,this.imagesLoaded=!1};p.funcs({setup:function(){this.PLAYER._logger.debug("setting up image loader");var t=this.PLAYER._config.props;void 0!==t.buttonsDir&&(this.PLAYER._controls.setup(this.PLAYER._html.controls_div),this.loadButtonImages(t.buttonsDir))},loadButtonImages:function(t){var e=this.PLAYER,s=e._config.props.buttonHover||!1,n=e._controls;e._logger.debug("Loading images for controls"),n.play.length>0&&(this.play=new Image,this.play.src=t+"play.png",this.pause=new Image,this.pause.src=t+"pause.png",s===!0&&(this.playOver=new Image,this.playOver.src=t+"play-over.png",this.pauseOver=new Image,this.pauseOver.src=t+"pause-over.png")),n.skip.length>0&&(this.skip=new Image,this.skip.src=t+"skip.png",s===!0&&(this.skipOver=new Image,this.skipOver.src=t+"skip-over.png")),n.back.length>0&&(this.back=new Image,this.back.src=t+"back.png",s===!0&&(this.backOver=new Image,this.backOver.src=t+"back-over.png")),n.stop.length>0&&(this.stop=new Image,this.stop.src=t+"stop.png",s===!0&&(this.stopOver=new Image,this.stopOver.src=t+"stop-over.png")),this.imagesLoaded=!0,this.PLAYER._logger.info("Images Loaded.")}});var c=function(){this._logger=null,this._data=null,this._html=null,this._config=null,this._events=null,this._controls=null,this._imageLoader=null,this._swaggPlayerApi=null};c.funcs({init:function(t){function s(){i._html;var t=i._data,s=t.songs[0],n=i._config;i.createSongs(),t.curr_song=0,i._events.setupSeek(),void 0!==n.props.autoPlay&&n.props.autoPlay===!0&&setTimeout(function(){i.play(t.curr_song)},1e3),i.executeIfExists("onSetupComplete",this,[i._swaggPlayerApi,s]),e.isIe()||console.timeEnd&&console.timeEnd("SwaggPlayerStart"),i._logger.info("Swagg Player ready!")}function n(){i._logger.error("An error has occured with loading Sound Manager! Rebooting."),i.executeIfExists("onErrorComplete",i,[])}t=t;var i=this,r={url:"/swf",consoleOnly:!0,flashVersion:9,wmode:"transparent",useHTML5Audio:!0,useHighPerformance:!1,flashLoadTimeout:1e3,debugMode:!0};this.initComponents(t),soundManager.onerror=n,soundManager.onload=s,soundManager.ontimeout=n,soundManager.setup(r)},createSongs:function(){var t=this;this._logger.info("createSongs()");var e=t._data,s=e.songs;if(void 0!==e.songs[0]){t._config,t._html;for(var n=new o(t),i=null,r=null,a=0,l=s.length;l>a;a++)i=s[a],r=n.createSound(i)}else this._logger.error("No Songs!!")},initComponents:function(e){var s=this;this._config=new n(this),this._config.props=t.extend(this._config.props,e),this._logger=new i(this,e.id),this._logger.info("initializing swagg player components"),this._data=new l(this),this._html=new u(this),this._html.initHtml(e),t.when(this._data.getSongs()).done(function(t){t?this.executeIfExists("onError",this,[]):(soundManager.supported()?s._logger.info("SM2 support was found! It SHOULD be smooth sailing from here but hey, you never know - this web development stuff is tricky!"):s._logger.warn("Support for SM2 was not found immediately! A reboot will probably occur. We shall see what happense after that."),s._html.setupProgressBar(),s.setupApi(),s._controls=new g(s),s._imageLoader=new p(s),s._imageLoader.setup(),void 0!==e.buttonsDir&&s._controls.setup(s._html.controls_div),s._events=new h(s),s._events.bindControllerEvents(),s._events.bindMediaKeyEvents())})},_whileplaying:function(t){this.progress(t);var e=t.loaded===!0?t.duration:t.durationEstimate,s=this.millsToTime(t.position),n=this.millsToTime(e),i={currentMins:s.mins,currentSecs:s.secs,totalMins:n.mins,totalSecs:n.secs};return[i]},_onplay:function(e){var s,n=this._data,i=n.songs[n.curr_song],r={};for(s in i)"id"!=s&&t.isFunction(i[s])===!1&&(r[s]=i[s]);return this.playPauseButtonState(0),this.loaded(e)===!0&&this.fillLoaded(),[r]},_onpause:function(){return this.playPauseButtonState(1),[]},_onstop:function(){return this.playPauseButtonState(1),[]},_onfinish:function(t){var e;if(this.internal.repeatMode===!1){var s=parseInt(t.id.split("-")[3],10),n=this._data.songs.length-1;n>s?this.skip(1):(this.stopMusic(),e=[])}else this.repeat();return e},_onresume:function(){return this.playPauseButtonState(0),[]},_whileloading:function(t){var e=100*this.whileLoading(t).toFixed(2);return[Math.round(e)]},_onerror:function(){var t="An error occured while attempting to play this song. Sorry about that.";return this._logger.error(t),[t]},executeIfExists:function(e,s,n){var i=this._config;i.props[e]&&t.isFunction(i.props[e])&&i.props[e].apply(s,n)},getDuration:function(t){var e;return e=t.loaded!==!0?t.durationEstimate:t.duration},repeat:function(){var t=this._html.player+"-song-"+this._data.curr_song,e=soundManager.getSoundById(t);this._logger.info("repeat()"),this.resetProgressBar(),e.setPosition(0),e.play()},play:function(t){var e,s=this._html.player+"-song-"+t,n=soundManager.getSoundById(s);return this._logger.debug("Playing track: "+s),n.paused===!0?(this._logger.debug("Unpausing song"),n.resume()):1===n.playState?(this._logger.info("Pausing current track"),n.pause()):(e=!0,this._logger.info("Playing current track from beginning"),n.play()),e},setupApi:function(){this._logger.debug("setting up api"),this._swaggPlayerApi=new d(this),this.internal.player=this},playPauseButtonState:function(t){var e=this._imageLoader.imagesLoaded,s=this._imageLoader.play.src,n=this._controls.play;1===t?s=this._imageLoader.play.src:0===t?s=this._imageLoader.pause.src:this._logger.error("Invalid button state! : "+t),e===!0&&n.attr("src",s)},skip:function(t){var e=this._data;this._html;var s=parseInt(e.curr_song);this._logger.info("skip()"),1===t?s<e.songs.length&&(s===e.songs.length-1?s=0:s+=1):0===t?0===s?s=parseInt(e.songs.length-1):s-=1:this._logger.error("Invalid skip direction flag: "+t),this.stopMusic(),e.curr_song=s,this.play(s)},jumpTo:function(t){this._logger.debug("jumping to track "+t),this.stopMusic(),this._data.curr_song=t,this.play(t)},resetProgressBar:function(){this._html.bar.css("width",0),this._html.loaded.css("width",0)},stopMusic:function(){this._logger.debug("stopping music"),this.playPauseButtonState(1),this.resetProgressBar(),soundManager.stopAll()},volume:function(t,e){var s=this._html.player+"-song-"+t,n=soundManager.getSoundById(s),i=n.volume;1===e?(this._logger.debug("increasing volume"),soundManager.setVolume(s,i+this._data.vol_interval)):0===e?(this._logger.debug("decreasing volume"),soundManager.setVolume(s,i-this._data.vol_interval)):this._logger.error("Invalid volume flag!")},fillLoaded:function(){this._html.loaded.css("width",this._html.metadata.progressWrapperWidth)},loaded:function(t){return t.loaded===!0&&3===t.readyState&&t.bytesLoaded===t.bytesTotal?!0:!1},whileLoading:function(t){var e=(t.position,t.bytesLoaded/t.bytesTotal);t.duration;var s=this._html.metadata.progressWrapperWidth,n=s*e;return this._html.loaded.css("width",n),e},progress:function(t){var e=t.position,s=0;t.bytesLoaded/t.bytesTotal,s=t.loaded===!1?t.durationEstimate:t.duration;var n=e/s,i=this._html.metadata.progressWrapperWidth,r=i*n;this._html.bar.css("width",r)},millsToTime:function(t){var e=new r,s=Math.floor(t/1e3),n=0;return s>60&&(n=Math.floor(s/60),s=Math.round(s%60)),60===s&&(n+=1,s=0),{mins:e.timeString(n),secs:e.timeString(s)}},internal:{player:null,repeatMode:!1}});var d=function(e){var s=this;this.player={adjustProgress:function(){var t=e._html,s=t.player+"-song-"+e._data.curr_song.toString();t.metadata.progressWrapperWidth=parseFloat(t.progress_wrapper.css("width"));var n=soundManager.getSoundById(s);e.whileLoading(n)}},s.playback={setRepeat:function(t){return e.internal.repeatMode=t===!0||t===!1?t:!1,s},inRepeat:function(){var t=e.internal.repeat;return t===!0||t===!1?t:!1},volUp:function(){return e.volume(e._data.curr_song,1),s},volDown:function(){return e.volume(e._data.curr_song,0),s},playTrack:function(t){var n=t-1;return n<=e._data_.last_song&&n>=0?e.jumpTo(t-1):e._logger.apierror("Invalid track number '"+t+"'"),s},togglePlay:function(){e.play(e._data.curr_song)},stop:function(){e.stopMusic()},addTracks:function(s,n){var i,r,l,u,g=(e.PLAYER,new o(e));if(t.isArray(s))for(u=0;u<s.length;u++)i=e._data.last_song,r=new a(s[u],i+1),l=g.createSound(r);else i=e._data.last_song,r=new a(s,i+1),l=g.createSound(r);n&&n.apply(null,[])}}}});